name: Deploy to Salesforce via SFDX

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Choose the Salesforce environment"
        required: true
        default: "Sandbox"
        type: choice
        options:
          - Sandbox
          - Production

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Salesforce CLI
        run: npm install sfdx-cli --global

      - name: Authenticate to Salesforce (device login)
        run: |
          if [ "${{ github.event.inputs.environment }}" == "Production" ]; then
            echo "Authenticating to Production..."
            sfdx auth:device:login -d -r https://login.salesforce.com
          else
            echo "Authenticating to Sandbox..."
            sfdx auth:device:login -d -r https://test.salesforce.com
          fi

      - name: Deploy Metadata
        run: |
          if [ "${{ github.event.inputs.environment }}" == "Production" ]; then
            echo "Deploying to Production..."
            sfdx force:source:deploy -p force-app -u <alias> --checkonly --testlevel RunLocalTests
          else
            echo "Deploying to Sandbox..."
            sfdx force:source:deploy -p force-app -u <alias> --checkonly --testlevel RunLocalTests
          fi
